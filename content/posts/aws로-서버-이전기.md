---
template: post
title: AWS로 서버 이전기
author: billy
date: 2021-08-09T13:03:33.488Z
description: AWS로 서버를 이전한 기록을 남겨봅니다
category: 개발
tags:
- aws
---
기존에 사용하던 iWinV서버에서 AWS로 모두 이전하고 숨겨진 에러가 튀어나오는 것을 차례로 대응한 후 이제 안정화 된 것 같아 이전기라는 것을 기록으로 남겨보려고 합니다.

## 왜 AWS로 이전했나?

사실 iWinV는 개인적 수준으로 사용했을때부터 저렴한 가격에 클라우드서버를 제공해 주고 있었기 때문에, 또 문제가 발생했을때도 한국말로 거의 "즉시"에 가깝게 이메일 대응을 해주거나 무려 전화를 해주는 등 만족이 높았던 서비스이기 때문에 가격이나 편의를 생각하면 (특히 이전 과정에서 어떤 문제가 생길지 모르는 리스크?) 그대로 쓰는 것도 나쁘지 않았습니다.

### 하지만

1. 보안적으로 AWS구성을 사용하는 것이 나았습니다

이제 점점 서비스도 확장하고 사용자도 늘어가는데, 업계 1위다운 다양한 보안서비스를 제공하는 AWS를 쓰는 것이 유리했습니다. 가끔 해킹당하는 서버들의 뉴스를 보면 좀 더 신경 쓰는 게 맞겠죠. 기존 썬데이나마스떼 서버로도 다양한 요청?공격?이 들어왔었습니다.

2. AWS Credit 이 있습니다

AWS에서는 스타트업들에게 AWS credit을 지급하여 익숙하게 사용하게끔 트레이닝을 시키는 투자를 종종 합니다. 말하자만 가두리양식 인데, 그 스타트업이 잘 성장하기만 하면 큰 규모의 고객이 되는 것이죠. 썬데이나마스떼도 이런 기회를 통해 $5000 정도를 받았었고, 2022년까지 만료이기 때문에 써보고 싶었습니다.

3. AWS의 다양한 서비스를 경험해 보았습니다

기존에는 EC2에 해당하는 서버만을 가지고, 모두 직접 구성해서 사용하였지만, AWS로 이전하면서 Route53, CloudFront, EC2, RDS, S3, SES, CodeDeploy, WAF, Lambda 등의 제품을 사용하게 되었습니다. 사실 AWS는 업계를 리딩하는 위치에 있기 때문에 Azure나 gcp에서 비슷한 제품이 있어도 AWS의 xxx같은 서비스..라고 소개할 것이기 때문에 AWS에 대해, 또 이런 아키텍쳐에 대해 사용해가면서 익숙해 지는 것은 좋은 경험이 될 것 같았습니다.

4. 확장성이 좋아졌습니다.

위와 같은 다양한 AWS제품을 조합해 사용하면 서비스가 단기간에 커질때 확장에 유용합니다. 썬데이나마스떼가 좀 더 빨리 대중적으로 알려져 각종 트래픽을 감당할 수 있는 구조로 늘려나가면 좋겠습니다.

## AWS구성은 어떻게 알고 했나?

다른 개발건과 마찬가지로 공부를 하고 많은 삽질(?)을 거쳐 사용법을 익히게 되었습니다. 전 회사에서 사용을 하기는 하였지만 대기업이다보니 TA가 따로 있어 구성/설정과 같은 사항은 볼 기회가 없었습니다. (사실 회사에 다니다 보면 수동적으로 일하기 십상이라 안보게 되기도 하고요.) AWS의 장점 중 하나는 사용자가 많다보니 국내외로 정보가 많아서 찾아보기 쉬운 편이었습니다. 다만 공식 홈페이지를 통해 제공하는 정보가 너무 딱딱하고, 기능이 많이 넣어야 해서인지 UI가 매우 불편하고 이해하기 힘들었지만요.

![aws](/media/aws.jpg "선데이나마스떼?")

AWS코리아에서 초기 아키텍쳐를 잡는데 도움을 주었고 (이때와는 달라졌지만), 별도의 벤더사가 존재하여 질문할 수 있어서 도움이 되었습니다. 벤더사는 여느 IT벤더사와 비슷하게 총판이나 도매의 개념으로 AWS계약을 벤더사와 하게 되면 그 후로 비용도 벤더사에 내게 되며(다행히 보유한 credit도 이전하여 사용할 수 있었습니다), 질문이나 아키텍쳐 설계등에 도움을 제공해 주었습니다. 실제적으로 셋팅 중간에 이해가 안되는 점을 물어봐서 해결할 수 있어서 좋았습니다. 비용은 AWS에 지불하는 것과 동일하기 때문에 선택하게 되었습니다. (벤더사에서는 CloudFront 가격 등을 단체납품? 도매? 비용과 같이 저렴하게 받아온 후 동일비용을 받아서 이윤을 남기는 구조 같습니다)

## AWS 이전할때 고생한 부분

1. lightsail 은 한계가 많습니다

더 효율적인 아키텍쳐 (frontend를 lambda로 serverless로 ssr처리하거나 prerendering을 사용하거나)를 셋팅하다가 시간이 너무 걸려서 일단 포기한 후 단순히 EC2를 사용하려고 한 후 LightSail 정도면 되겠다고 생각하고 셋팅을 다 했는데, 문제가 있었습니다. LightSail의 CloudFront (Distribution)은 origin을 여러개 설정 할 수 없었습니다. CloudFront에서 기본적인 Path Routing을 해주는데, Path Routing을 통해 서비스를 나누고 싶다면 ALB를 달거나 CF를 달거나 Lambda를 이용하거나 nginx까지 내려서 분기를 시키거나 해야합니다. AWS서비스를 이용해 간단히 처리하고 싶었는데 그중 CF에서 처리하는 것이 가장 간단했지만, LightSail의 CF는 origin을 여러개 사용할 수 없어 이걸 못해줍니다. 이 밖에도 EC2에서 제공하는 세세한 설정이 다 없습니다.

상업적이지 않은 수준의 서버를 돌리고자 하면 그냥 iwinv에서 nginx를 사용하는 정도로 확실히 저렴하게 쓰고, 아니라면 LightSail은 거르고 EC2로 바로 가는 것이 맞는 것 같다는 생각이 들었습니다.

2. Timezone 문제

이번엔 서버와 DB셋팅시에 Timezone을 설정했는데, 문제가 있어서 놀랐습니다.

'Asia/Seoul'로 설정하려면 MySql의 time_zone, MySql connector의 timezone 옵션, Node의 TZ 환경변수. 이 3가지를 모두를 설정 해야 정상 동작하는 것을 알았네요. 큰 오류없이 수정하긴 했지만 MySql connector는 DB서버의 timezone을 자동으로 따라가야 할 것 같은데 아니었나 봅니다. 이건 개발stack에 따라 달라질 수 있는 문제 같긴 합니다.

## 서버 이전을 통해

늘 이런 일을 벌이고 많은 시행착오를 하다 보면, 시간이 부족한데 왜 또 일을 벌였나 하는 생각이 드는 경우가 많긴 하지만 어쨌든 새로운일을 직접해보며 이해하는 일은 즐거운 것 같습니다.

기술부채를 안고 빠른 개발과 성장을 이루는 것도 중요하지만 새로운 기술을 꾸준히 도입해서 미래를 대비하는 점도 좋은 것 같습니다. 서비스도 지속적으로 많이 개선하고 있는 만큼, 인프라 쪽으로 꾸준히 발전시켜서 탄탄한 서비스를 제공하는 썬데이나마스떼가 되겠습니다.
